# A Dockerisable Version of SABIO

## contents

 
 - [`data/`](./data/): Data for SABIO, specifically, a subset of the [NMVW collection](https://collectie.wereldculturen.nl/) and the [OpenBeelden](https://www.openbeelden.nl/) dataset by Beeld & Geluid. Pre-processed to be parseable by the SABIO backend and engines. For SABIO, each dataset consists of 3 files: a table of objects and their metadata, a table listing URLs for images and thumbnails and a JSON file which specifies for the SABIO engines how the fields in the main table are to be interpreted. 
 - [`src/`](./src/): The SABIO backend, including the Flask app in `app.py`, helper functionaolities in `datasets.py` and `results.py` and the SABIO engine definitions in `engines/`.
 - [`cache/`](./cache/): Pre-computed and cached versions of the SABIO engines for the NMVW and OpenBeelden datasets. 
 
 - [`start.sh`](./start.sh): see [running](#running) below

 - [`requirements.txt`](./requirements.txt) - list of versioned Python packages used by the SABIO Flask app (file autogenerated by [pigar](https://github.com/damnever/pigar)); slight exception: gunicorn, the WSGI used to spawn Python backend Flask apps
 

## installation

Once the required Python packages are installed, this folder can be run as-is; specifically [`./src/app.py`](./src/app.py) which is the Flask app or [`./start.sh`](./start.sh) which uses gunicorn to run the Flask app.

## running

some notes:

 - running the SABIO backend Flask app has been tested with `gunicorn` as a load balancer and WSGI apps, see [`start.sh`](./start.sh) but it's not necessary to use `gunicorn`; the parameters used in [`start.sh`](./start.sh) are:  

 - imports in the Python scripts & modules are relative and paths to files in `./cache` and `./data` hard-coded. This implies that `./src/app.py` ca only be run from `./src`

 - each spawned worker (e.g. by `gunicorn`) occupies the same amount of RAM, there is no sharing of resources (due to the Python GIL)
 
 - on start-up the Flask app checks if the engines defined in [`src/engines/`](./src/engines/) are pre-computed (i.e. present in `./cache/`), if not it computes them on the fly and saves them there; note that some of the engines require significant RAM and time to be computed in their first instance
 
## docker

- build the image: `docker build . -t sabio-backend:1.0`
- run the container: `docker run -p 8080:8080 sabio-backend:1.0`
